# 短剧剧本生成工具 PRD

## 一、产品定位

**核心功能**：输入小说，自动生成专业格式的短剧剧本

**产品目标**：
- 降低剧本创作门槛，非专业用户也能获得高质量剧本
- 输出格式规范，可直接用于拍摄制作
- 交付质量稳定可控

---

## 二、核心问题

### 2.1 质量瓶颈

在测试中发现：**单一生成过程难以保证输出质量**。

| 问题 | 表现 |
|------|------|
| 规则覆盖不全 | 每次检查都能发现可优化项 |
| 模型注意力分散 | 生成时兼顾创意+规则，顾此失彼 |
| 格式不稳定 | 优化后格式一致性显著提升 |

### 2.2 解决方案

**生成-优化分离**（用户无感知）：

```
用户输入小说 ──▶ AI生成（专注创意）──▶ AI优化（专注规范）──▶ 输出剧本
                                      ↑
                                内部质量提升层
```

**关键点**：
- 优化对用户透明，不增加操作步骤
- 优化是质量保障的内部机制
- 优化模块可独立封装，后续扩展为独立功能

---

## 三、技术架构

### 3.1 整体架构

```
┌─────────────────────────────────────────────────────────────────────────┐
│                           用户交互层                                      │
│    输入：小说原文 + 配置参数（标题/题材/集数）                              │
│    输出：格式化剧本                                                       │
└─────────────────────────────────────────────────────────────────────────┘
                                    │
                                    ▼
┌─────────────────────────────────────────────────────────────────────────┐
│                           内部处理层                                      │
│                                                                          │
│  ┌──────────────┐     ┌──────────────┐     ┌──────────────┐             │
│  │   预处理模块   │ ──▶ │   生成引擎   │ ──▶ │   优化引擎   │             │
│  │  (规则+模型)   │     │   (模型)     │     │   (模型)     │             │
│  └──────────────┘     └──────────────┘     └──────────────┘             │
│         │                     │                     │                    │
│         ▼                     ▼                     ▼                    │
│  ┌──────────────┐     ┌──────────────┐     ┌──────────────┐             │
│  │  格式校验     │     │  分集规划    │     │  格式规范化   │             │
│  │  参数提取     │     │  场景拆解    │     │  提示补全     │             │
│  │  内容摘要     │     │  台词创作    │     │  一致性检查   │             │
│  └──────────────┘     └──────────────┘     └──────────────┘             │
│                                                                          │
└─────────────────────────────────────────────────────────────────────────┘
```

### 3.2 模块与模型调用关系

| 模块 | 是否调用模型 | 调用次数 | 模型角色 |
|------|-------------|---------|---------|
| 预处理模块 | 部分 | 0-1次 | 辅助摘要/参数提取 |
| 生成引擎 | 是 | 1次（整剧）或N次（分集） | 主要创作者 |
| 优化引擎 | 是 | 1次 | 质量审核 |

### 3.3 模型调用说明

#### 生成引擎

- **输入**：小说原文 + 配置参数 + 格式规范
- **输出**：完整剧本（草稿版）
- **调用方式**：
  - 整剧生成（<20,000字小说）
  - 分集生成（>20,000字小说，推荐）

#### 优化引擎

- **输入**：草稿剧本
- **输出**：优化后剧本 + 优化报告
- **优化维度**：
  - 格式规范化
  - 表演提示补全
  - 特写镜头检查
  - 配角记忆点校验
  - 一致性检查

---

## 四、模型特性与限制

### 4.1 长文本漂移问题

**现象**：生成内容过长时，模型容易偏离初始指令和格式规范

| 漂移表现 | 出现阶段 | 影响 |
|---------|---------|------|
| 场次编号错误 | 生成中后期 | 1-1, 1-2, 1-5, 2-1... |
| 格式不规范 | 生成中后期 | 缺失日/夜标注 |
| 配角记忆点遗漏 | 生成中后期 | 后半部分配角无口头禅 |
| 节奏失控 | 生成中后期 | 单集内容过多/过少 |

**应对策略**：
- 生成-优化分离，缓解单次生成压力
- 优化阶段统一修复格式问题
- 建议分集生成（每集独立调用）

### 4.2 Token 限制

| 限制项 | 典型值 | 建议处理 |
|--------|--------|---------|
| 上下文窗口 | 200K tokens | 超长小说需分块或摘要 |
| 单次输出 | ~50K tokens | 控制单次生成范围 |
| 规则指令 | ~10K tokens | 精简规则，避免冗余 |

### 4.3 输入规则

#### 字数限制与处理

| 字数范围 | 推荐集数 | 处理方式 |
|---------|---------|---------|
| < 5,000字 | 3-5集 | 直接生成 |
| 5,000-15,000字 | 10-15集 | 直接生成 |
| 15,000-30,000字 | 20-30集 | 直接生成（推荐分集） |
| > 30,000字 | > 30集 | 建议分批生成或人工拆分 |

#### 内容要求

**推荐输入**：
- 完整章节段落（非碎片化内容）
- 包含核心情节的完整片段
- 角色名称首次出现时标注

**不推荐输入**：
- 纯对话片段（缺乏场景描述）
- 严重碎片化的内容
- 缺少角色名称的匿名文本

---

## 五、输出规格

### 5.1 格式标准

```
# 短剧剧本：{标题}

**题材：** xxx
**总集数：** xx集

**故事梗概：** 1-2句话

**人物小传：**
| 角色 | 年龄 | 身份/职业 | 性格特点 | 核心背景 |
|------|------|-----------|---------|----------|
| xxx | xx岁 | xxx | xxx | xxx |

**表演记忆点：**
| 角色 | 性格标签 | 口头禅 | 标志性动作 |
|------|---------|--------|------------|
| xxx | xxx | xxx | xxx |

---

**第1集：标题**
**核心剧情：** xxx

1-1   场景名称     日/夜    内/外
人物：xxx

▲ 场景描述
【特写】关键镜头
人物（情绪）：台词
【★表演提示】

▲ 切镜

...
```

### 5.2 质量标准

| 指标 | 目标值 | 检查方式 |
|------|--------|---------|
| 格式规范率 | >95% | 自动化规则 |
| 场次编号准确率 | >98% | 规则检查 |
| 场景标注完整率 | >95% | 规则检查 |
| 情节还原度 | >90% | 抽样人工 |
| 配角记忆点覆盖率 | >80% | 规则检查 |

---

## 六、后续扩展能力

### 6.1 优化功能外显

当前优化是内部透明机制，后续可封装为独立功能：

| 功能 | 说明 | 用户价值 |
|------|------|---------|
| 优化报告 | 输出改进点清单 | 了解质量提升了什么 |
| 优化分级 | 基础/深度可选 | 按需选择优化程度 |
| 手动优化 | 确认后生效 | 对关键修改有掌控感 |
| 历史对比 | 优化前后对比 | 查看具体改动 |

### 6.2 独立优化模式

```
输入：已有剧本（任意格式）
处理：格式规范化 + 内容优化
输出：符合规范的优化版剧本
```

适用场景：
- 用户已有草稿，需要规范化
- 第三方剧本格式统一
- 批量处理已有内容

---

## 七、迭代路线

### Phase 1（当前）：内部优化机制

- [ ] 生成-优化两阶段流程
- [ ] 基础优化规则（格式+表演提示）
- [ ] 用户无感知交付

### Phase 2（近期）：优化可配置

- [ ] 优化规则可开关
- [ ] 优化报告输出（可选）
- [ ] 优化分级

### Phase 3（远期）：独立优化功能

- [ ] 独立优化入口
- [ ] 优化前后对比
- [ ] 批量优化能力

---

## 八、输入输出定义

### 8.1 输入

| 字段 | 必填 | 说明 |
|------|------|------|
| novel_content | 是 | 完整小说内容 |
| title | 否 | 默认为"短剧剧本" |
| genre | 否 | 自动识别或默认"都市" |
| total_episodes | 否 | 自动计算或默认30 |

### 8.2 输出

| 字段 | 说明 |
|------|------|
| script | 完整 Markdown 格式剧本 |
| optimization_report | 优化报告（可选） |
| metadata | 元信息（集数、人物清单等） |

---

## 九、格式规范要求

### 9.1 表格格式

**关键发现**：Claude 输出 Markdown 表格时，标题与表格之间必须有换行，否则渲染异常。

```
正确格式（有换行）：
**人物小传：**

| 角色 | 年龄 | ... |
|------|------|-----|

错误格式（无换行）：
**人物小传：**
| 角色 | 年龄 | ... |
```

### 9.2 配角记忆点要求

**关键发现**：口头禅/标志性动作只在首次出现无效，需在剧中至少出现 2-3 次才能形成记忆点。

**检查规则**：
- 口头禅需出现 ≥2 次
- 标志性动作需出现 ≥2 次
- 记忆点需贯穿角色戏份

### 9.3 优化策略分级

| 级别 | 包含内容 | 适用场景 |
|------|---------|---------|
| 基础优化 | 格式规范化、场次编号修复 | 默认，必选 |
| 标准优化 | 基础 + 表演提示补全、特写镜头 | 推荐 |
| 深度优化 | 标准 + 配角记忆点补全、台词口语化 | 高要求场景 |

---

## 十、角色设计要求

### 10.1 反派动机

**关键发现**：好的剧本需要反派有合理动机，不仅仅是"坏"。

**要求**：
- 每个反派需有清晰的作恶动机
- 动机需符合角色身份和背景
- 避免无脑反派，人物需有逻辑

**动机类型**：
- 利益驱动：财产、地位、权力
- 情感驱动：嫉妒、仇恨、爱而不得
- 生存驱动：自保、被胁迫、不得不为之
- 性格驱动：性格缺陷、成长经历导致

---

## 十一、验收标准

### 功能验收

- [ ] 输入小说可生成剧本
- [ ] 生成后自动优化，用户无额外操作
- [ ] 输出格式符合规范
- [ ] 配角有记忆点设计

### 质量验收

- [ ] 格式规范率 >95%
- [ ] 场次编号连续无缺失
- [ ] 场景标注完整
- [ ] 表演提示无冗余
- [ ] 配角记忆点在剧中多次出现
- [ ] 反派有合理动机

---

## 附录：参考文档

- 提示词手册：`剧本生成_提示词手册.md`
